<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/MarkerCluster.css">
        <link rel="stylesheet" href="css/MarkerCluster.Default.css">
        <link rel="stylesheet" href="css/leaflet-search.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        
/* --- Added header styling (no changes to map logic) --- */
:root {
  --header-h: 56px;
  --header-bg: #002B5B;
  --header-border: rgba(0,0,0,0.08);
  --header-text: #ffffff; /* slate-900 */
}
body {
  font-family: 'Plus Jakarta Sans', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}
.site-header{
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 72px;
  display: flex;
  align-items: center;
  padding: 8px 16px;
  background: var(--header-bg);
  backdrop-filter: saturate(180%) blur(8px);
  -webkit-backdrop-filter: saturate(180%) blur(8px);
  border-bottom: 1px solid var(--header-border);
  z-index: 1000; /* above Leaflet controls */
}
.site-header__title{
  font-weight: 700;
  letter-spacing: .2px;
  color: var(--header-text);
  font-size: 16px;
  line-height: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
/* push map below header */
#map{
  height: calc(100% - 72px) !important;
  margin-top: 72px !important;
}


/* --- On-load popup modal --- */
.modal-backdrop{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  display: none; /* default hidden, shown on load via JS */
  align-items: center;
  justify-content: center;
  z-index: 2000;
}
.modal{
  width: min(640px, calc(100% - 32px));
  background: #ffffff;
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(2,6,23,0.25);
  overflow: hidden;
  font-family: 'Plus Jakarta Sans', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}
.modal__header{
  background: #002B5B; /* match header blue */
  color: #ffffff;
  padding: 14px 18px;
  font-weight: 700;
  font-size: 16px;
}
.modal__body{
  padding: 16px 18px;
  color: #0f172a;
  line-height: 1.55;
  font-size: 14px;
}
.modal__footer{
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding: 12px 18px 16px;
}
.modal__btn{
  appearance: none;
  border: 0;
  border-radius: 10px;
  padding: 10px 14px;
  font-weight: 600;
  cursor: pointer;
}
.modal__btn--primary{
  background: #002B5B;
  color: #ffffff;
}
.modal__btn--ghost{
  background: #f1f5f9;
  color: #0f172a;
}

</style>
        <title></title>
            <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    </head>
    <body>
<header class="site-header" role="banner" aria-label="Site header">
  <div style="display:flex;flex-direction:column;">
      <div class="site-header__title" style="font-size:18px;font-weight:700;margin-bottom:4px;">SIGAP KUMUH</div>
      <div class="site-header__title" style="font-size:13px;font-weight:400;opacity:0.8;margin-top:2px;">Sistem Informasi Geografis Aksi Penanganan Kumuh Kabupaten Lamongan</div>
  </div>
</header>

<!-- On-load popup modal -->
<div class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" id="onload-modal">
  <div class="modal" tabindex="-1">
    <div class="modal__header" id="modal-title">Selamat datang di SIGAP KUMUH</div>
    <div class="modal__body" id="modal-desc">
      <p><strong>SIGAP KUMUH</strong> (Sistem Informasi Geografis Aksi Penanganan Kumuh Kabupaten Lamongan) menampilkan peta tematik, data aksi penanganan, dan fitur pencarian/pelaporan.</p>
      <p>Gunakan kontrol peta untuk menyalakan/mematikan layer, melakukan pencarian lokasi, dan melihat detail melalui pop-up.</p>
    </div>
    <div class="modal__footer">
      <button class="modal__btn modal__btn--ghost" id="modal-close-secondary" type="button">Tutup</button>
      <button class="modal__btn modal__btn--primary" id="modal-close" type="button" aria-label="Tutup dialog">Mengerti</button>
    </div>
  </div>
</div>


        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="js/leaflet.markercluster.js"></script>
        <script src="js/leaflet-search.js"></script>
        <script src="data/BatasAdministrasiKecamatan_1.js"></script>
        <script src="data/BatasAdministrasiDesa_2.js"></script>
        <script src="data/PekerjaanCiptaKarya2025_3.js"></script>
        <script src="data/SKKumuh2020_4.js"></script>
        <script src="data/SKKumuh2025_5.js"></script>
        <script src="data/PekerjaanPKP2024_6.js"></script>
        <script src="data/PekerjaanPKP2025_7.js"></script>
        <script src="data/RencanaPekerjaanPKP2026_8.js"></script>
        <script>
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        }).fitBounds([[-7.165251989218539,112.35059978669625],[-7.132664935225896,112.40431411402744]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // modify popup if contains media
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var imgTd = tempDiv.querySelector('td img');
            if (imgTd) {
                var src = imgTd.getAttribute('src');
                if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.update();
                    }, 10);
                } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                    var audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = src;
                    imgTd.parentNode.replaceChild(audio, imgTd);
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                    var video = document.createElement('video');
                    video.controls = true;
                    video.src = src;
                    video.style.width = "400px";
                    video.style.height = "300px";
                    video.style.maxHeight = "60vh";
                    video.style.maxWidth = "60vw";
                    imgTd.parentNode.replaceChild(video, imgTd);
                    popup._contentNode.classList.add('media');
                    // Aggiorna il popup quando il video carica i metadati
                    video.addEventListener('loadedmetadata', function() {
                        popup.update();
                    });
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else {
                    popup._contentNode.classList.remove('media');
                }
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_ESRI_0');
        map.getPane('pane_ESRI_0').style.zIndex = 400;
        var layer_ESRI_0 = L.tileLayer('https://server.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            pane: 'pane_ESRI_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_ESRI_0;
        map.addLayer(layer_ESRI_0);
        function pop_BatasAdministrasiKecamatan_1(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['OBJECTID'] !== null ? autolinker.link(String(feature.properties['OBJECTID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['LUASHA'] !== null ? autolinker.link(String(feature.properties['LUASHA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Kumuh_25'] !== null ? autolinker.link(String(feature.properties['Kumuh_25']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Kumuh_20'] !== null ? autolinker.link(String(feature.properties['Kumuh_20']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_BatasAdministrasiKecamatan_1_0(feature) {
            switch(String(feature.properties['Kumuh_25'])) {
                case 'Kumuh':
                    return {
                pane: 'pane_BatasAdministrasiKecamatan_1',
                opacity: 1,
                color: 'rgba(0,0,0,0.5)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,137,0,0.37450980392156863)',
                interactive: false,
            }
                    break;
                case 'Tidak Kumuh':
                    return {
                pane: 'pane_BatasAdministrasiKecamatan_1',
                opacity: 1,
                color: 'rgba(35,35,35,0.5)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(196,196,196,0.26862745098039215)',
                interactive: false,
            }
                    break;
            }
        }
        map.createPane('pane_BatasAdministrasiKecamatan_1');
        map.getPane('pane_BatasAdministrasiKecamatan_1').style.zIndex = 401;
        map.getPane('pane_BatasAdministrasiKecamatan_1').style['mix-blend-mode'] = 'normal';
        var layer_BatasAdministrasiKecamatan_1 = new L.geoJson(json_BatasAdministrasiKecamatan_1, {
            attribution: '',
            interactive: false,
            dataVar: 'json_BatasAdministrasiKecamatan_1',
            layerName: 'layer_BatasAdministrasiKecamatan_1',
            pane: 'pane_BatasAdministrasiKecamatan_1',
            onEachFeature: pop_BatasAdministrasiKecamatan_1,
            style: style_BatasAdministrasiKecamatan_1_0,
        });
        bounds_group.addLayer(layer_BatasAdministrasiKecamatan_1);
        map.addLayer(layer_BatasAdministrasiKecamatan_1);
        function pop_BatasAdministrasiDesa_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['OBJECTID'] !== null ? autolinker.link(String(feature.properties['OBJECTID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMKD'] !== null ? autolinker.link(String(feature.properties['WADMKD']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['LUAS'] !== null ? autolinker.link(String(feature.properties['LUAS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Kumuh_25'] !== null ? autolinker.link(String(feature.properties['Kumuh_25']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Kumuh_20'] !== null ? autolinker.link(String(feature.properties['Kumuh_20']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_BatasAdministrasiDesa_2_0() {
            return {
                pane: 'pane_BatasAdministrasiDesa_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(223,248,255,0.0)',
                interactive: false,
            }
        }
        map.createPane('pane_BatasAdministrasiDesa_2');
        map.getPane('pane_BatasAdministrasiDesa_2').style.zIndex = 402;
        map.getPane('pane_BatasAdministrasiDesa_2').style['mix-blend-mode'] = 'normal';
        var layer_BatasAdministrasiDesa_2 = new L.geoJson(json_BatasAdministrasiDesa_2, {
            attribution: '',
            interactive: false,
            dataVar: 'json_BatasAdministrasiDesa_2',
            layerName: 'layer_BatasAdministrasiDesa_2',
            pane: 'pane_BatasAdministrasiDesa_2',
            onEachFeature: pop_BatasAdministrasiDesa_2,
            style: style_BatasAdministrasiDesa_2_0,
        });
        bounds_group.addLayer(layer_BatasAdministrasiDesa_2);
        map.addLayer(layer_BatasAdministrasiDesa_2);
        function pop_PekerjaanCiptaKarya2025_3(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">No SPK</th>\
                        <td class="visible-with-data" id="No SPK">' + (feature.properties['No SPK'] !== null ? autolinker.link(String(feature.properties['No SPK']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nama Proye</th>\
                        <td class="visible-with-data" id="Nama Proye">' + (feature.properties['Nama Proye'] !== null ? autolinker.link(String(feature.properties['Nama Proye']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Pelaksana</th>\
                        <td class="visible-with-data" id="Pelaksana">' + (feature.properties['Pelaksana'] !== null ? autolinker.link(String(feature.properties['Pelaksana']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nilai Kont</th>\
                        <td class="visible-with-data" id="Nilai Kont">' + (feature.properties['Nilai Kont'] !== null ? autolinker.link(String(feature.properties['Nilai Kont']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Mulai</th>\
                        <td>' + (feature.properties['Mulai'] !== null ? autolinker.link(String(feature.properties['Mulai']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Berakhir</th>\
                        <td>' + (feature.properties['Berakhir'] !== null ? autolinker.link(String(feature.properties['Berakhir']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Progress</th>\
                        <td class="visible-with-data" id="Progress">' + (feature.properties['Progress'] !== null ? autolinker.link(String(feature.properties['Progress']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td class="visible-with-data" id="Sebelum" colspan="2"><strong>Sebelum</strong><br />' + (feature.properties['Sebelum'] !== null ? '<img src="images/' + String(feature.properties['Sebelum']).replace(/[\\/:]/g, '_').trim().replace(/'/g, '\'').replace(/"/g, '&quot;') + '">' : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td class="visible-with-data" id="Sesudah" colspan="2"><strong>Sesudah</strong><br />' + (feature.properties['Sesudah'] !== null ? '<img src="images/' + String(feature.properties['Sesudah']).replace(/[\\/:]/g, '_').trim().replace(/'/g, '\'').replace(/"/g, '&quot;') + '">' : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        var pattern_PekerjaanCiptaKarya2025_3_0 = new L.StripePattern({
            weight: 1.0,
            spaceWeight: 2.0,
            color: '#ffe900',
            opacity: 1.0,
            spaceOpacity: 0,
            angle: 315
        });
        pattern_PekerjaanCiptaKarya2025_3_0.addTo(map);
        function style_PekerjaanCiptaKarya2025_3_0() {
            return {
                pane: 'pane_PekerjaanCiptaKarya2025_3',
                stroke: false,
                fillOpacity: 1,
                fillPattern: pattern_PekerjaanCiptaKarya2025_3_0,
                interactive: true,
            }
        }
        map.createPane('pane_PekerjaanCiptaKarya2025_3');
        map.getPane('pane_PekerjaanCiptaKarya2025_3').style.zIndex = 403;
        map.getPane('pane_PekerjaanCiptaKarya2025_3').style['mix-blend-mode'] = 'normal';
        var layer_PekerjaanCiptaKarya2025_3 = new L.geoJson(json_PekerjaanCiptaKarya2025_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_PekerjaanCiptaKarya2025_3',
            layerName: 'layer_PekerjaanCiptaKarya2025_3',
            pane: 'pane_PekerjaanCiptaKarya2025_3',
            onEachFeature: pop_PekerjaanCiptaKarya2025_3,
            style: style_PekerjaanCiptaKarya2025_3_0,
        });
        bounds_group.addLayer(layer_PekerjaanCiptaKarya2025_3);
        map.addLayer(layer_PekerjaanCiptaKarya2025_3);
        function pop_SKKumuh2020_4(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Sumber</th>\
                        <td>' + (feature.properties['Sumber'] !== null ? autolinker.link(String(feature.properties['Sumber']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Provinsi</th>\
                        <td>' + (feature.properties['Provinsi'] !== null ? autolinker.link(String(feature.properties['Provinsi']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kabupaten</th>\
                        <td>' + (feature.properties['Kabupaten'] !== null ? autolinker.link(String(feature.properties['Kabupaten']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kecamatan</th>\
                        <td>' + (feature.properties['Kecamatan'] !== null ? autolinker.link(String(feature.properties['Kecamatan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Desa/Kelur</th>\
                        <td>' + (feature.properties['Desa/Kelur'] !== null ? autolinker.link(String(feature.properties['Desa/Kelur']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">RT/RW</th>\
                        <td>' + (feature.properties['RT/RW'] !== null ? autolinker.link(String(feature.properties['RT/RW']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kawasan</th>\
                        <td>' + (feature.properties['Kawasan'] !== null ? autolinker.link(String(feature.properties['Kawasan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nilai</th>\
                        <td class="visible-with-data" id="Nilai">' + (feature.properties['Nilai'] !== null ? autolinker.link(String(feature.properties['Nilai']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Tingkat</th>\
                        <td class="visible-with-data" id="Tingkat">' + (feature.properties['Tingkat'] !== null ? autolinker.link(String(feature.properties['Tingkat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Luas</th>\
                        <td>' + (feature.properties['Luas'] !== null ? autolinker.link(String(feature.properties['Luas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_SKKumuh2020_4_0() {
            return {
                pane: 'pane_SKKumuh2020_4',
                opacity: 1,
                color: 'rgba(196,196,196,0.7)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(196,196,196,0.7)',
                interactive: true,
            }
        }
        map.createPane('pane_SKKumuh2020_4');
        map.getPane('pane_SKKumuh2020_4').style.zIndex = 404;
        map.getPane('pane_SKKumuh2020_4').style['mix-blend-mode'] = 'normal';
        var layer_SKKumuh2020_4 = new L.geoJson(json_SKKumuh2020_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_SKKumuh2020_4',
            layerName: 'layer_SKKumuh2020_4',
            pane: 'pane_SKKumuh2020_4',
            onEachFeature: pop_SKKumuh2020_4,
            style: style_SKKumuh2020_4_0,
        });
        bounds_group.addLayer(layer_SKKumuh2020_4);
        map.addLayer(layer_SKKumuh2020_4);
        function pop_SKKumuh2025_5(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Sumber</th>\
                        <td>' + (feature.properties['Sumber'] !== null ? autolinker.link(String(feature.properties['Sumber']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Provinsi</th>\
                        <td>' + (feature.properties['Provinsi'] !== null ? autolinker.link(String(feature.properties['Provinsi']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kabupaten</th>\
                        <td>' + (feature.properties['Kabupaten'] !== null ? autolinker.link(String(feature.properties['Kabupaten']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kecamatan</th>\
                        <td>' + (feature.properties['Kecamatan'] !== null ? autolinker.link(String(feature.properties['Kecamatan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Desa/Kelur</th>\
                        <td>' + (feature.properties['Desa/Kelur'] !== null ? autolinker.link(String(feature.properties['Desa/Kelur']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">RT/RW</th>\
                        <td>' + (feature.properties['RT/RW'] !== null ? autolinker.link(String(feature.properties['RT/RW']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kawasan</th>\
                        <td>' + (feature.properties['Kawasan'] !== null ? autolinker.link(String(feature.properties['Kawasan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nilai</th>\
                        <td>' + (feature.properties['Nilai'] !== null ? autolinker.link(String(feature.properties['Nilai']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Tingkat</th>\
                        <td>' + (feature.properties['Tingkat'] !== null ? autolinker.link(String(feature.properties['Tingkat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Luas</th>\
                        <td>' + (feature.properties['Luas'] !== null ? autolinker.link(String(feature.properties['Luas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kewenangan</th>\
                        <td>' + (feature.properties['Kewenangan'] !== null ? autolinker.link(String(feature.properties['Kewenangan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_SKKumuh2025_5_0() {
            return {
                pane: 'pane_SKKumuh2025_5',
                opacity: 1,
                color: 'rgba(128,14,16,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,0,3,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_SKKumuh2025_5');
        map.getPane('pane_SKKumuh2025_5').style.zIndex = 405;
        map.getPane('pane_SKKumuh2025_5').style['mix-blend-mode'] = 'normal';
        var layer_SKKumuh2025_5 = new L.geoJson(json_SKKumuh2025_5, {
            attribution: '',
            interactive: true,
            dataVar: 'json_SKKumuh2025_5',
            layerName: 'layer_SKKumuh2025_5',
            pane: 'pane_SKKumuh2025_5',
            onEachFeature: pop_SKKumuh2025_5,
            style: style_SKKumuh2025_5_0,
        });
        bounds_group.addLayer(layer_SKKumuh2025_5);
        map.addLayer(layer_SKKumuh2025_5);
        function pop_PekerjaanPKP2024_6(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">No SPK</th>\
                        <td>' + (feature.properties['No SPK'] !== null ? autolinker.link(String(feature.properties['No SPK']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nama Kegia</th>\
                        <td>' + (feature.properties['Nama Kegia'] !== null ? autolinker.link(String(feature.properties['Nama Kegia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Jenis</th>\
                        <td>' + (feature.properties['Jenis'] !== null ? autolinker.link(String(feature.properties['Jenis']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Pekerjaan</th>\
                        <td>' + (feature.properties['Pekerjaan'] !== null ? autolinker.link(String(feature.properties['Pekerjaan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Dana</th>\
                        <td>' + (feature.properties['Dana'] !== null ? autolinker.link(String(feature.properties['Dana']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Dusun</th>\
                        <td>' + (feature.properties['Dusun'] !== null ? autolinker.link(String(feature.properties['Dusun']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Desa/Kelur</th>\
                        <td>' + (feature.properties['Desa/Kelur'] !== null ? autolinker.link(String(feature.properties['Desa/Kelur']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kecamatan</th>\
                        <td>' + (feature.properties['Kecamatan'] !== null ? autolinker.link(String(feature.properties['Kecamatan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Progress</th>\
                        <td>' + (feature.properties['Progress'] !== null ? autolinker.link(String(feature.properties['Progress']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td class="visible-with-data" id="Sebelum" colspan="2"><strong>Sebelum</strong><br />' + (feature.properties['Sebelum'] !== null ? '<img src="images/' + String(feature.properties['Sebelum']).replace(/[\\/:]/g, '_').trim().replace(/'/g, '\'').replace(/"/g, '&quot;') + '">' : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td class="visible-with-data" id="Sesudah" colspan="2"><strong>Sesudah</strong><br />' + (feature.properties['Sesudah'] !== null ? '<img src="images/' + String(feature.properties['Sesudah']).replace(/[\\/:]/g, '_').trim().replace(/'/g, '\'').replace(/"/g, '&quot;') + '">' : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_PekerjaanPKP2024_6_0() {
            return {
                pane: 'pane_PekerjaanPKP2024_6',
        rotationAngle: 0.0,
        rotationOrigin: 'center center',
        icon: L.icon({
            iconUrl: 'markers/PekerjaanPKP2024_6.svg',
            iconSize: [38.0, 38.0]
        }),
                interactive: true,
            }
        }
        map.createPane('pane_PekerjaanPKP2024_6');
        map.getPane('pane_PekerjaanPKP2024_6').style.zIndex = 406;
        map.getPane('pane_PekerjaanPKP2024_6').style['mix-blend-mode'] = 'normal';
        var layer_PekerjaanPKP2024_6 = new L.geoJson(json_PekerjaanPKP2024_6, {
            attribution: '',
            interactive: true,
            dataVar: 'json_PekerjaanPKP2024_6',
            layerName: 'layer_PekerjaanPKP2024_6',
            pane: 'pane_PekerjaanPKP2024_6',
            onEachFeature: pop_PekerjaanPKP2024_6,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.marker(latlng, style_PekerjaanPKP2024_6_0(feature));
            },
        });
        bounds_group.addLayer(layer_PekerjaanPKP2024_6);
        map.addLayer(layer_PekerjaanPKP2024_6);
        function pop_PekerjaanPKP2025_7(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">No SPK</th>\
                        <td class="visible-with-data" id="No SPK">' + (feature.properties['No SPK'] !== null ? autolinker.link(String(feature.properties['No SPK']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nama Kegia</th>\
                        <td class="visible-with-data" id="Nama Kegia">' + (feature.properties['Nama Kegia'] !== null ? autolinker.link(String(feature.properties['Nama Kegia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Jenis</th>\
                        <td class="visible-with-data" id="Jenis">' + (feature.properties['Jenis'] !== null ? autolinker.link(String(feature.properties['Jenis']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Pekerjaan</th>\
                        <td class="visible-with-data" id="Pekerjaan">' + (feature.properties['Pekerjaan'] !== null ? autolinker.link(String(feature.properties['Pekerjaan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Dana</th>\
                        <td class="visible-with-data" id="Dana">' + (feature.properties['Dana'] !== null ? autolinker.link(String(feature.properties['Dana']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Dusun</th>\
                        <td class="visible-with-data" id="Dusun">' + (feature.properties['Dusun'] !== null ? autolinker.link(String(feature.properties['Dusun']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Desa/Kelur</th>\
                        <td class="visible-with-data" id="Desa/Kelur">' + (feature.properties['Desa/Kelur'] !== null ? autolinker.link(String(feature.properties['Desa/Kelur']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kecamatan</th>\
                        <td class="visible-with-data" id="Kecamatan">' + (feature.properties['Kecamatan'] !== null ? autolinker.link(String(feature.properties['Kecamatan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Progress</th>\
                        <td class="visible-with-data" id="Progress">' + (feature.properties['Progress'] !== null ? autolinker.link(String(feature.properties['Progress']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sebelum</th>\
                        <td class="visible-with-data" id="Sebelum">' + (feature.properties['Sebelum'] !== null ? '<img src="images/' + String(feature.properties['Sebelum']).replace(/[\\/:]/g, '_').trim().replace(/'/g, '\'').replace(/"/g, '&quot;') + '">' : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sesudah</th>\
                        <td class="visible-with-data" id="Sesudah">' + (feature.properties['Sesudah'] !== null ? '<img src="images/' + String(feature.properties['Sesudah']).replace(/[\\/:]/g, '_').trim().replace(/'/g, '\'').replace(/"/g, '&quot;') + '">' : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_PekerjaanPKP2025_7_0() {
            return {
                pane: 'pane_PekerjaanPKP2025_7',
        rotationAngle: 0.0,
        rotationOrigin: 'center center',
        icon: L.icon({
            iconUrl: 'markers/PekerjaanPKP2025_7.svg',
            iconSize: [38.0, 38.0]
        }),
                interactive: true,
            }
        }
        map.createPane('pane_PekerjaanPKP2025_7');
        map.getPane('pane_PekerjaanPKP2025_7').style.zIndex = 407;
        map.getPane('pane_PekerjaanPKP2025_7').style['mix-blend-mode'] = 'normal';
        var layer_PekerjaanPKP2025_7 = new L.geoJson(json_PekerjaanPKP2025_7, {
            attribution: '',
            interactive: true,
            dataVar: 'json_PekerjaanPKP2025_7',
            layerName: 'layer_PekerjaanPKP2025_7',
            pane: 'pane_PekerjaanPKP2025_7',
            onEachFeature: pop_PekerjaanPKP2025_7,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.marker(latlng, style_PekerjaanPKP2025_7_0(feature));
            },
        });
        var cluster_PekerjaanPKP2025_7 = new L.MarkerClusterGroup({showCoverageOnHover: false,
            spiderfyDistanceMultiplier: 2});
        cluster_PekerjaanPKP2025_7.addLayer(layer_PekerjaanPKP2025_7);

        bounds_group.addLayer(layer_PekerjaanPKP2025_7);
        cluster_PekerjaanPKP2025_7.addTo(map);
        function pop_RencanaPekerjaanPKP2026_8(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">No Usulan</th>\
                        <td class="visible-with-data" id="No Usulan">' + (feature.properties['No Usulan'] !== null ? autolinker.link(String(feature.properties['No Usulan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nama Kegia</th>\
                        <td class="visible-with-data" id="Nama Kegia">' + (feature.properties['Nama Kegia'] !== null ? autolinker.link(String(feature.properties['Nama Kegia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Jenis</th>\
                        <td>' + (feature.properties['Jenis'] !== null ? autolinker.link(String(feature.properties['Jenis']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Pekerjaan</th>\
                        <td>' + (feature.properties['Pekerjaan'] !== null ? autolinker.link(String(feature.properties['Pekerjaan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Dana</th>\
                        <td>' + (feature.properties['Dana'] !== null ? autolinker.link(String(feature.properties['Dana']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Dusun</th>\
                        <td>' + (feature.properties['Dusun'] !== null ? autolinker.link(String(feature.properties['Dusun']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Desa/Kelur</th>\
                        <td class="visible-with-data" id="Desa/Kelur">' + (feature.properties['Desa/Kelur'] !== null ? autolinker.link(String(feature.properties['Desa/Kelur']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kecamatan</th>\
                        <td>' + (feature.properties['Kecamatan'] !== null ? autolinker.link(String(feature.properties['Kecamatan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Panjang/Lu</th>\
                        <td class="visible-with-data" id="Panjang/Lu">' + (feature.properties['Panjang/Lu'] !== null ? autolinker.link(String(feature.properties['Panjang/Lu']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Anggaran</th>\
                        <td>' + (feature.properties['Anggaran'] !== null ? autolinker.link(String(feature.properties['Anggaran']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_RencanaPekerjaanPKP2026_8_0() {
            return {
                pane: 'pane_RencanaPekerjaanPKP2026_8',
        rotationAngle: 0.0,
        rotationOrigin: 'center center',
        icon: L.icon({
            iconUrl: 'markers/RencanaPekerjaanPKP2026_8.svg',
            iconSize: [15.2, 15.2]
        }),
                interactive: true,
            }
        }
        map.createPane('pane_RencanaPekerjaanPKP2026_8');
        map.getPane('pane_RencanaPekerjaanPKP2026_8').style.zIndex = 408;
        map.getPane('pane_RencanaPekerjaanPKP2026_8').style['mix-blend-mode'] = 'normal';
        var layer_RencanaPekerjaanPKP2026_8 = new L.geoJson(json_RencanaPekerjaanPKP2026_8, {
            attribution: '',
            interactive: true,
            dataVar: 'json_RencanaPekerjaanPKP2026_8',
            layerName: 'layer_RencanaPekerjaanPKP2026_8',
            pane: 'pane_RencanaPekerjaanPKP2026_8',
            onEachFeature: pop_RencanaPekerjaanPKP2026_8,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.marker(latlng, style_RencanaPekerjaanPKP2026_8_0(feature));
            },
        });
        var cluster_RencanaPekerjaanPKP2026_8 = new L.MarkerClusterGroup({showCoverageOnHover: false,
            spiderfyDistanceMultiplier: 2});
        cluster_RencanaPekerjaanPKP2026_8.addLayer(layer_RencanaPekerjaanPKP2026_8);

        bounds_group.addLayer(layer_RencanaPekerjaanPKP2026_8);
        cluster_RencanaPekerjaanPKP2026_8.addTo(map);
        const url = {"Nominatim OSM": "https://nominatim.openstreetmap.org/search?format=geojson&addressdetails=1&",
        "France BAN": "https://api-adresse.data.gouv.fr/search/?"}
        var photonControl = L.control.photon({
            url: url["Nominatim OSM"],
            feedbackLabel: '',
            position: 'topleft',
            includePosition: true,
            initial: true,
            // resultsHandler: myHandler,
        }).addTo(map);
        photonControl._container.childNodes[0].style.borderRadius="10px"
        // Create a variable to store the geoJSON data
        var x = null;
        // Create a variable to store the marker
        var marker = null;
        // Add an event listener to the Photon control to create a marker from the returned geoJSON data
        var z = null;
        photonControl.on('selected', function(e) {
            console.log(photonControl.search.resultsContainer);
            if (x != null) {
                map.removeLayer(obj3.marker);
                map.removeLayer(x);
            }
            obj2.gcd = e.choice;
            x = L.geoJSON(obj2.gcd).addTo(map);
            var label = typeof obj2.gcd.properties.label === 'undefined' ? obj2.gcd.properties.display_name : obj2.gcd.properties.label;
            obj3.marker = L.marker(x.getLayers()[0].getLatLng()).bindPopup(label).addTo(map);
            map.setView(x.getLayers()[0].getLatLng(), 17);
            z = typeof e.choice.properties.label === 'undefined'? e.choice.properties.display_name : e.choice.properties.label;
            console.log(e);
            e.target.input.value = z;
        });
        var search = document.getElementsByClassName("leaflet-photon leaflet-control")[0];
        search.classList.add("leaflet-control-search")
        search.style.display = "flex";
        search.style.backgroundColor="rgba(255,255,255,0.5)" 

        // Create the new button element
        var button = document.createElement("div");
        button.id = "gcd-button-control";
        button.className = "gcd-gl-btn fa fa-search search-button";

        // Insert the button at the beginning of the search control
        search.insertBefore(button, search.firstChild);
        last = search.lastChild;
        last.style.display = "none";
        button.addEventListener("click", function (e) {
            if (last.style.display === "none") {
                last.style.display = "block";
            } else {
                last.style.display = "none";
            }
        });
        var overlaysTree = [
        {label: '<b>Pekerjaan Fisik PKP</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: '<img src="legend/RencanaPekerjaanPKP2026_8.png" /> Rencana Pekerjaan PKP 2026', layer: cluster_RencanaPekerjaanPKP2026_8},
            {label: '<img src="legend/PekerjaanPKP2025_7.png" /> Pekerjaan PKP 2025', layer: cluster_PekerjaanPKP2025_7},
            {label: '<img src="legend/PekerjaanPKP2024_6.png" /> Pekerjaan PKP 2024', layer: layer_PekerjaanPKP2024_6},]},
        {label: '<b>SK Kumuh</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: '<img src="legend/SKKumuh2025_5.png" /> SK Kumuh 2025', layer: layer_SKKumuh2025_5},
            {label: '<img src="legend/SKKumuh2020_4.png" /> SK Kumuh 2020', layer: layer_SKKumuh2020_4},]},
        {label: '<b>Pekerjaan Fisik Cipta Karya</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: '<img src="legend/PekerjaanCiptaKarya2025_3.png" /> Pekerjaan Cipta Karya 2025', layer: layer_PekerjaanCiptaKarya2025_3},]},
        {label: '<b>Batas Wilayah</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: '<img src="legend/BatasAdministrasiDesa_2.png" /> Batas Administrasi Desa', layer: layer_BatasAdministrasiDesa_2},
            {label: 'Batas Administrasi Kecamatan<br /><table><tr><td style="text-align: center;"><img src="legend/BatasAdministrasiKecamatan_1_Kumuh0.png" /></td><td>Kumuh</td></tr><tr><td style="text-align: center;"><img src="legend/BatasAdministrasiKecamatan_1_TidakKumuh1.png" /></td><td>Tidak Kumuh</td></tr></table>', layer: layer_BatasAdministrasiKecamatan_1},]},
        {label: '<b>Basemap</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: "ESRI", layer: layer_ESRI_0, radioGroup: 'bm' },]},]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: false, 
        });
        lay.addTo(map);
		document.addEventListener("DOMContentLoaded", function() {
            // set new Layers List height which considers toggle icon
            function newLayersListHeight() {
                var layerScrollbarElement = document.querySelector('.leaflet-control-layers-scrollbar');
                if (layerScrollbarElement) {
                    var layersListElement = document.querySelector('.leaflet-control-layers-list');
                    var originalHeight = layersListElement.style.height 
                        || window.getComputedStyle(layersListElement).height;
                    var newHeight = parseFloat(originalHeight) - 50;
                    layersListElement.style.height = newHeight + 'px';
                }
            }
            var isLayersListExpanded = true;
            var controlLayersElement = document.querySelector('.leaflet-control-layers');
            var toggleLayerControl = document.querySelector('.leaflet-control-layers-toggle');
            // toggle Collapsed/Expanded and apply new Layers List height
            toggleLayerControl.addEventListener('click', function() {
                if (isLayersListExpanded) {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                } else {
                    controlLayersElement.classList.add('leaflet-control-layers-expanded');
                }
                isLayersListExpanded = !isLayersListExpanded;
                newLayersListHeight()
            });	
			// apply new Layers List height if toggle layerstree
			if (controlLayersElement) {
				controlLayersElement.addEventListener('click', function(event) {
					var toggleLayerHeaderPointer = event.target.closest('.leaflet-layerstree-header-pointer span');
					if (toggleLayerHeaderPointer) {
						newLayersListHeight();
					}
				});
			}
            // Collapsed/Expanded at Start to apply new height
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            // Collapsed touch/small screen
            var isSmallScreen = window.innerWidth < 650;
            if (isSmallScreen) {
                setTimeout(function() {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                    isLayersListExpanded = !isLayersListExpanded;
                }, 500);
            }  
        });       
        setBounds();
        var i = 0;
        layer_BatasAdministrasiKecamatan_1.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['WADMKC'] !== null?String('<div style="color: #323232; font-size: 8pt; font-weight: bold; font-family: \'Plus Jakarta Sans\', sans-serif;">' + layer.feature.properties['WADMKC']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_BatasAdministrasiKecamatan_1'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        map.addControl(new L.Control.Search({
            layer: cluster_BatasAdministrasiDesa_2,
            initial: false,
            hideMarkerOnCollapse: true,
            propertyName: 'WADMKD'}));
        if (typeof url === 'undefined') {
            document.getElementsByClassName('search-button')[0].className += ' fa fa-binoculars';
        } else {
            document.getElementsByClassName('search-button')[1].className += ' fa fa-binoculars';
        }
        resetLabels([layer_BatasAdministrasiKecamatan_1]);
        map.on("zoomend", function(){
            resetLabels([layer_BatasAdministrasiKecamatan_1]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_BatasAdministrasiKecamatan_1]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_BatasAdministrasiKecamatan_1]);
        });
        </script>        
    
<script>
(function(){
  const backdrop = document.getElementById('onload-modal');
  if (!backdrop) return;
  const dialog = backdrop.querySelector('.modal');
  const closeBtn = document.getElementById('modal-close');
  const closeBtn2 = document.getElementById('modal-close-secondary');

  function openModal(){
    backdrop.style.display = 'flex';
    // move focus for accessibility
    setTimeout(()=>dialog && dialog.focus(), 0);
  }
  function closeModal(){
    backdrop.style.display = 'none';
  }

  // open on load
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', openModal);
  } else {
    openModal();
  }

  // close interactions
  [closeBtn, closeBtn2].forEach(btn => btn && btn.addEventListener('click', closeModal));
  backdrop.addEventListener('click', (e)=>{
    if (e.target === backdrop) closeModal();
  });
  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape') closeModal();
  });
})();
</script>

</body>
</html>
